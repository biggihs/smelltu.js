(function(f,g){function b(a,d){if(typeof a===g||typeof d===g)throw"ClickStream() takes 2 arguments: name, code";this._name=encodeURIComponent(a);this._code=d;this.bannerOnScreenDetected=this.clickHasRegistered=this.hasRun=!1;return this}b.fire_and_forget=function(a,d){var e=f("<iframe/>"),c=f("<form/>");e.css({display:"none"});c.attr({method:"post",action:a});for(var b in d){var g=f("<input/>").attr({type:"hidden",name:b,value:d[b]});c.append(g)}c.append("<input/>",{type:"submit"});f("body").append(e); e.contents().find("body").append(c);c.submit();return this};b.prototype.onscreenpageview=function(a){this.bannerOnScreenDetected||(check_is_visible()?(this.bannerOnScreenDetected=!0,this.track("onscreenpageview",a)):setTimeout("click_stream.onscreenpageview("+a.toSource()+");",5E3));return this};b.prototype.pageview=function(a){return this.hasRun?this:(this.hasRun=!0,this.track("pageview",a))};b.prototype.clickthrough=function(a){return this.clickHasRegistered?this:(this.clickHasRegistered=!0,this.track("clickthrough", a))};b.prototype.track=function(a,d){var e={name:this._name,host:window.location.host,pr:10,cs:2,type:a},c;for(c in d)e[c]=d[c];if("pageview"===a&&0!==Math.floor(Math.random()*e.pr)||"onscreenpageview"===a&&0!==Math.floor(Math.random()*e.pr))return this;b.fire_and_forget("http://www.smelltu.is/track/"+this._code+"/",e);return this};window.ClickStream=b})(jQuery);
